{"version":3,"file":"Image.js","sources":["../../src/Image.js"],"sourcesContent":["import {select} from \"d3-selection\";\nimport {transition} from \"d3-transition\";\n\nimport {accessor, constant} from \"d3plus-common\";\n\n/**\n    @class Image\n    @desc Creates SVG images based on an array of data.\n    @example <caption>a sample row of data</caption>\nvar data = {\"url\": \"file.png\", \"width\": \"100\", \"height\": \"50\"};\n@example <caption>passed to the generator</caption>\nnew Image().data([data]).render();\n@example <caption>creates the following</caption>\n<image class=\"d3plus-Image\" opacity=\"1\" href=\"file.png\" width=\"100\" height=\"50\" x=\"0\" y=\"0\"></image>\n@example <caption>this is shorthand for the following</caption>\nimage().data([data])();\n@example <caption>which also allows a post-draw callback function</caption>\nimage().data([data])(function() { alert(\"draw complete!\"); })\n*/\nexport default class Image {\n\n  /**\n      @memberof Image\n      @desc Invoked when creating a new class instance, and sets any default parameters.\n      @private\n  */\n  constructor() {\n    this._duration = 600;\n    this._height = accessor(\"height\");\n    this._id = accessor(\"id\");\n    this._pointerEvents = constant(\"auto\");\n    this._select;\n    this._url = accessor(\"url\");\n    this._width = accessor(\"width\");\n    this._x = accessor(\"x\", 0);\n    this._y = accessor(\"y\", 0);\n  }\n\n  /**\n      @memberof Image\n      @desc Renders the current Image to the page. If a *callback* is specified, it will be called once the images are done drawing.\n      @param {Function} [*callback*]\n      @chainable\n  */\n  render(callback) {\n\n    if (this._select === void 0) this.select(select(\"body\").append(\"svg\").style(\"width\", `${window.innerWidth}px`).style(\"height\", `${window.innerHeight}px`).style(\"display\", \"block\").node());\n\n    const images = this._select.selectAll(\".d3plus-Image\").data(this._data, this._id);\n\n    const enter = images.enter().append(\"image\")\n      .attr(\"class\", \"d3plus-Image\")\n      .attr(\"opacity\", 0)\n      .attr(\"width\", 0)\n      .attr(\"height\", 0)\n      .attr(\"x\", (d, i) => this._x(d, i) + this._width(d, i) / 2)\n      .attr(\"y\", (d, i) => this._y(d, i) + this._height(d, i) / 2);\n\n    const t = transition().duration(this._duration),\n          that = this,\n          update = enter.merge(images);\n\n    update\n      .attr(\"xlink:href\", this._url)\n      .style(\"pointer-events\", this._pointerEvents)\n      .transition(t)\n      .attr(\"opacity\", 1)\n      .attr(\"width\", (d, i) => this._width(d, i))\n      .attr(\"height\", (d, i) => this._height(d, i))\n      .attr(\"x\", (d, i) => this._x(d, i))\n      .attr(\"y\", (d, i) => this._y(d, i))\n      .each(function(d, i) {\n        const image = select(this), link = that._url(d, i);\n        const fullAddress = link.indexOf(\"http://\") === 0 || link.indexOf(\"https://\") === 0;\n        if (!fullAddress || link.indexOf(window.location.hostname) === 0) {\n          const img = new Image();\n          img.src = link;\n          img.crossOrigin = \"Anonymous\";\n          img.onload = function() {\n            const canvas = document.createElement(\"canvas\");\n            canvas.width = this.width;\n            canvas.height = this.height;\n            const context = canvas.getContext(\"2d\");\n            context.drawImage(this, 0, 0);\n            image.attr(\"xlink:href\", canvas.toDataURL(\"image/png\"));\n          };\n        }\n      });\n\n    images.exit().transition(t)\n      .attr(\"width\", (d, i) => this._width(d, i))\n      .attr(\"height\", (d, i) => this._height(d, i))\n      .attr(\"x\", (d, i) => this._x(d, i))\n      .attr(\"y\", (d, i) => this._y(d, i))\n      .attr(\"opacity\", 0).remove();\n\n    if (callback) setTimeout(callback, this._duration + 100);\n\n    return this;\n\n  }\n\n  /**\n      @memberof Image\n      @desc If *data* is specified, sets the data array to the specified array and returns the current class instance. If *data* is not specified, returns the current data array. An <image> tag will be drawn for each object in the array.\n      @param {Array} [*data* = []]\n      @chainable\n  */\n  data(_) {\n    return arguments.length ? (this._data = _, this) : this._data;\n  }\n\n  /**\n      @memberof Image\n      @desc If *ms* is specified, sets the animation duration to the specified number and returns the current class instance. If *ms* is not specified, returns the current animation duration.\n      @param {Number} [*ms* = 600]\n      @chainable\n  */\n  duration(_) {\n    return arguments.length ? (this._duration = _, this) : this._duration;\n  }\n\n  /**\n      @memberof Image\n      @desc If *value* is specified, sets the height accessor to the specified function or number and returns the current class instance.\n      @param {Function|Number} [*value*]\n      @chainable\n      @example\nfunction(d) {\n  return d.height;\n}\n  */\n  height(_) {\n    return arguments.length ? (this._height = typeof _ === \"function\" ? _ : constant(_), this) : this._height;\n  }\n\n  /**\n      @memberof Image\n      @desc If *value* is specified, sets the id accessor to the specified function and returns the current class instance.\n      @param {Function} [*value*]\n      @chainable\n      @example\nfunction(d) {\n  return d.id;\n}\n  */\n  id(_) {\n    return arguments.length ? (this._id = _, this) : this._id;\n  }\n\n  /**\n      @memberof Image\n      @desc If *value* is specified, sets the pointer-events accessor to the specified function or string and returns the current class instance.\n      @param {Function|String} [*value* = \"auto\"]\n      @chainable\n  */\n  pointerEvents(_) {\n    return arguments.length ? (this._pointerEvents = typeof _ === \"function\" ? _ : constant(_), this) : this._pointerEvents;\n  }\n\n  /**\n      @memberof Image\n      @desc If *selector* is specified, sets the SVG container element to the specified d3 selector or DOM element and returns the current class instance. If *selector* is not specified, returns the current SVG container element.\n      @param {String|HTMLElement} [*selector* = d3.select(\"body\").append(\"svg\")]\n      @chainable\n  */\n  select(_) {\n    return arguments.length ? (this._select = select(_), this) : this._select;\n  }\n\n  /**\n      @memberof Image\n      @desc If *value* is specified, sets the URL accessor to the specified function and returns the current class instance.\n      @param {Function} [*value*]\n      @chainable\n      @example\nfunction(d) {\n  return d.url;\n}\n  */\n  url(_) {\n    return arguments.length ? (this._url = _, this) : this._url;\n  }\n\n  /**\n      @memberof Image\n      @desc If *value* is specified, sets the width accessor to the specified function or number and returns the current class instance.\n      @param {Function|Number} [*value*]\n      @chainable\n      @example\nfunction(d) {\n  return d.width;\n}\n  */\n  width(_) {\n    return arguments.length ? (this._width = typeof _ === \"function\" ? _ : constant(_), this) : this._width;\n  }\n\n  /**\n      @memberof Image\n      @desc If *value* is specified, sets the x accessor to the specified function or number and returns the current class instance.\n      @param {Function|Number} [*value*]\n      @chainable\n      @example\nfunction(d) {\n  return d.x || 0;\n}\n  */\n  x(_) {\n    return arguments.length ? (this._x = typeof _ === \"function\" ? _ : constant(_), this) : this._x;\n  }\n\n  /**\n      @memberof Image\n      @desc If *value* is specified, sets the y accessor to the specified function or number and returns the current class instance.\n      @param {Function|Number} [*value*]\n      @chainable\n      @example\nfunction(d) {\n  return d.y || 0;\n}\n  */\n  y(_) {\n    return arguments.length ? (this._y = typeof _ === \"function\" ? _ : constant(_), this) : this._y;\n  }\n\n}\n"],"names":["const","this"],"mappings":"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"}