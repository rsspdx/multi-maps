{"version":3,"file":"Whisker.js","sources":["../../../src/Shape/Whisker.js"],"sourcesContent":["import {select} from \"d3-selection\";\n\nimport {accessor, assign, BaseClass, configPrep, constant, elem} from \"d3plus-common\";\nimport {nest} from \"d3-collection\";\n\nimport Circle from \"./Circle\";\nimport Line from \"./Line\";\nimport Rect from \"./Rect\";\n\nconst shapes = {Circle, Rect};\n\n/**\n    @class Whisker\n    @extends BaseClass\n    @desc Creates SVG whisker based on an array of data.\n*/\nexport default class Whisker extends BaseClass {\n\n  /**\n      @memberof Whisker\n      @desc Invoked when creating a new class instance, and overrides any default parameters inherited from BaseClass.\n      @private\n  */\n  constructor() {\n\n    super();\n\n    this._endpoint = accessor(\"endpoint\", \"Rect\");\n    this._endpointConfig = {\n      Circle: {\n        r: accessor(\"r\", 5)\n      }\n    };\n    this._length = accessor(\"length\", 25);\n    this._lineConfig = {};\n    this._orient = accessor(\"orient\", \"top\");\n    this._x = accessor(\"x\", 0);\n    this._y = accessor(\"y\", 0);\n\n  }\n\n  /**\n      @memberof Whisker\n      @desc Draws the whisker.\n      @param {Function} [*callback*]\n      @chainable\n  */\n  render(callback) {\n\n    if (this._select === void 0) {\n      this.select(select(\"body\").append(\"svg\")\n        .style(\"width\", `${window.innerWidth}px`)\n        .style(\"height\", `${window.innerHeight}px`)\n        .style(\"display\", \"block\").node());\n    }\n\n    const lineData = [];\n    this._data.forEach((d, i) => {\n\n      const orient = this._orient(d, i);\n      const x = this._x(d, i);\n      const y = this._y(d, i);\n\n      let endpointX = x;\n      if (orient === \"left\") endpointX -= this._length(d, i);\n      else if (orient === \"right\") endpointX += this._length(d, i);\n\n      let endpointY = y;\n      if (orient === \"top\") endpointY -= this._length(d, i);\n      else if (orient === \"bottom\") endpointY += this._length(d, i);\n\n      lineData.push({__d3plus__: true, data: d, i, id: i, x, y});\n      lineData.push({__d3plus__: true, data: d, i, id: i, x: endpointX, y: endpointY});\n    });\n\n    // Draw whisker line.\n    this._line = new Line()\n      .data(lineData)\n      .select(elem(\"g.d3plus-Whisker\", {parent: this._select}).node())\n      .config(configPrep.bind(this)(this._lineConfig, \"shape\"))\n      .render(callback);\n\n    const whiskerData = this._data.map((d, i) => {\n\n      const dataObj = {};\n      dataObj.__d3plus__ = true;\n      dataObj.data = d;\n      dataObj.i = i;\n      dataObj.endpoint = this._endpoint(d, i);\n      dataObj.length = this._length(d, i);\n      dataObj.orient = this._orient(d, i);\n\n      let endpointX = this._x(d, i);\n      if (dataObj.orient === \"left\") endpointX -= dataObj.length;\n      else if (dataObj.orient === \"right\") endpointX += dataObj.length;\n\n      let endpointY = this._y(d, i);\n      if (dataObj.orient === \"top\") endpointY -= dataObj.length;\n      else if (dataObj.orient === \"bottom\") endpointY += dataObj.length;\n\n      dataObj.x = endpointX;\n      dataObj.y = endpointY;\n\n      return dataObj;\n\n    });\n\n    // Draw whisker endpoint.\n    this._whiskerEndpoint = [];\n    nest()\n      .key(d => d.endpoint)\n      .entries(whiskerData)\n      .forEach(shapeData => {\n        const shapeName = shapeData.key;\n        this._whiskerEndpoint.push(new shapes[shapeName]()\n          .data(shapeData.values)\n          .select(elem(`g.d3plus-Whisker-Endpoint-${shapeName}`, {parent: this._select}).node())\n          .config({\n            height: d => d.orient === \"top\" || d.orient === \"bottom\" ? 5 : 20,\n            width: d => d.orient === \"top\" || d.orient === \"bottom\" ? 20 : 5\n          })\n          .config(configPrep.bind(this)(this._endpointConfig, \"shape\", shapeName))\n          .render());\n      });\n\n    return this;\n\n  }\n\n  /**\n      @memberof Whisker\n      @desc Sets the highlight accessor to the Shape class's active function.\n      @param {Function} [*value*]\n      @chainable\n  */\n  active(_) {\n    if (this._line) this._line.active(_);\n    if (this._whiskerEndpoint) this._whiskerEndpoint.forEach(endPoint => endPoint.active(_));\n  }\n\n  /**\n      @memberof Whisker\n      @desc If *data* is specified, sets the data array to the specified array and returns the current class instance. If *data* is not specified, returns the current data array.\n      @param {Array} [*data* = []]\n      @chainable\n  */\n  data(_) {\n    return arguments.length ? (this._data = _, this) : this._data;\n  }\n\n  /**\n      @memberof Whisker\n      @desc If *value* is specified, sets the endpoint accessor to the specified function or string and returns the current class instance.\n      @param {Function|String}\n      @chainable\n  */\n  endpoint(_) {\n    return arguments.length ? (this._endpoint = typeof _ === \"function\" ? _ : constant(_), this) : this._endpoint;\n  }\n\n  /**\n      @memberof Whisker\n      @desc If *value* is specified, sets the config method for each endpoint and returns the current class instance.\n      @param {Object} [*value*]\n      @chainable\n  */\n  endpointConfig(_) {\n    return arguments.length ? (this._endpointConfig = assign(this._endpointConfig, _), this) : this._endpointConfig;\n  }\n\n  /**\n      @memberof Whisker\n      @desc Sets the highlight accessor to the Shape class's hover function.\n      @param {Function} [*value*]\n      @chainable\n  */\n  hover(_) {\n    if (this._line) this._line.hover(_);\n    if (this._whiskerEndpoint) this._whiskerEndpoint.forEach(endPoint => endPoint.hover(_));\n  }\n\n  /**\n      @memberof Whisker\n      @desc If *value* is specified, sets the length accessor for whisker and returns the current class instance.\n      @param {Function|Number} [*value*]\n      @chainable\n  */\n  length(_) {\n    return arguments.length ? (this._length = typeof _ === \"function\" ? _ : constant(_), this) : this._length;\n  }\n\n  /**\n      @memberof Whisker\n      @desc If *value* is specified, sets the config method for line shape and returns the current class instance.\n      @param {Object} [*value*]\n      @chainable\n  */\n  lineConfig(_) {\n    return arguments.length ? (this._lineConfig = assign(this._lineConfig, _), this) : this._lineConfig;\n  }\n  \n  /**\n      @memberof Whisker\n      @desc If *value* is specified, sets the orientation to the specified value. If *value* is not specified, returns the current orientation.\n      @param {Function|String} [*value* = \"top\"] Accepts \"top\", \"right\", \"bottom\" or \"left\"\n      @chainable\n  */\n  orient(_) {\n    return arguments.length ? (this._orient = typeof _ === \"function\" ? _ : constant(_), this) : this._orient;\n  }\n\n  /**\n      @memberof Whisker\n      @desc If *selector* is specified, sets the SVG container element to the specified d3 selector or DOM element and returns the current class instance. If *selector* is not specified, returns the current SVG container element.\n      @param {String|HTMLElement} [*selector* = d3.select(\"body\").append(\"svg\")]\n      @chainable\n  */\n  select(_) {\n    return arguments.length ? (this._select = select(_), this) : this._select;\n  }\n\n  /**\n    @memberof Whisker\n    @desc If *value* is specified, sets the x axis to the specified function or number and returns the current class instance.\n    @param {Function|Number} [*value*]\n    @chainable\n    @example\nfunction(d) {\n  return d.x;\n}\n  */\n  x(_) {\n    return arguments.length ? (this._x = typeof _ === \"function\" ? _ : constant(_), this) : this._x;\n  }\n\n  /**\n      @memberof Whisker\n      @desc If *value* is specified, sets the y axis to the specified function or number and returns the current class instance.\n      @param {Function|Number} [*value*]\n      @chainable\n      @example\nfunction(d) {\n  return d.y;\n}\n  */\n  y(_) {\n    return arguments.length ? (this._y = typeof _ === \"function\" ? _ : constant(_), this) : this._y;\n  }\n\n}\n"],"names":["const","super","this","let"],"mappings":"AAAA,QAAQ,MAAM,OAAO,cAAc,CAAC;;AAEpC,QAAQ,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,QAAQ,EAAE,IAAI,OAAO,eAAe,CAAC;AACtF,QAAQ,IAAI,OAAO,eAAe,CAAC;;AAEnC,OAAO,MAAM,MAAM,UAAU,CAAC;AAC9B,OAAO,IAAI,MAAM,QAAQ,CAAC;AAC1B,OAAO,IAAI,MAAM,QAAQ,CAAC;;AAE1BA,GAAK,CAAC,MAAM,GAAG,SAAC,MAAM,QAAE,IAAI,CAAC,CAAC;;;;;;;AAO9B,AAAe,IAAM,OAAO,GAAkB;EAO5C,gBAAW,GAAG;;IAEZC,cAAK,KAAC,CAAC,CAAC;;IAER,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;IAC9C,IAAI,CAAC,eAAe,GAAG;MACrB,MAAM,EAAE;QACN,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC;OACpB;KACF,CAAC;IACF,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;IACtC,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;IACtB,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;IACzC,IAAI,CAAC,EAAE,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;IAC3B,IAAI,CAAC,EAAE,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;;;;;;0CAE5B;;;;;;;;oBAQD,yBAAM,CAAC,QAAQ,EAAE;;AAAC;;IAEhB,IAAI,IAAI,CAAC,OAAO,KAAK,KAAK,CAAC,EAAE;MAC3B,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC;SACrC,KAAK,CAAC,OAAO,EAAE,EAAG,MAAM,CAAC,WAAU,QAAI,CAAC;SACxC,KAAK,CAAC,QAAQ,EAAE,EAAG,MAAM,CAAC,YAAW,QAAI,CAAC;SAC1C,KAAK,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;KACtC;;IAEDD,GAAK,CAAC,QAAQ,GAAG,EAAE,CAAC;IACpB,IAAI,CAAC,KAAK,CAAC,OAAO,UAAC,CAAC,CAAC,EAAE,CAAC,EAAE,AAAG;;MAE3BA,GAAK,CAAC,MAAM,GAAGE,MAAI,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MAClCF,GAAK,CAAC,CAAC,GAAGE,MAAI,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MACxBF,GAAK,CAAC,CAAC,GAAGE,MAAI,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;;MAExBC,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC;MAClB,IAAI,MAAM,KAAK,MAAM,IAAE,SAAS,IAAID,MAAI,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,GAAC;WAClD,IAAI,MAAM,KAAK,OAAO,IAAE,SAAS,IAAIA,MAAI,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,GAAC;;MAE7DC,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC;MAClB,IAAI,MAAM,KAAK,KAAK,IAAE,SAAS,IAAID,MAAI,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,GAAC;WACjD,IAAI,MAAM,KAAK,QAAQ,IAAE,SAAS,IAAIA,MAAI,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,GAAC;;MAE9D,QAAQ,CAAC,IAAI,CAAC,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,KAAE,CAAC,EAAE,EAAE,EAAE,CAAC,KAAE,CAAC,KAAE,CAAC,CAAC,CAAC,CAAC;MAC3D,QAAQ,CAAC,IAAI,CAAC,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,KAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC;KAClF,CAAC,CAAC;;;IAGH,IAAI,CAAC,KAAK,GAAG,IAAI,IAAI,EAAE;OACpB,IAAI,CAAC,QAAQ,CAAC;OACd,MAAM,CAAC,IAAI,CAAC,kBAAkB,EAAE,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;OAC/D,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;OACxD,MAAM,CAAC,QAAQ,CAAC,CAAC;;IAEpBF,GAAK,CAAC,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,UAAC,CAAC,CAAC,EAAE,CAAC,EAAE,AAAG;;MAE3CA,GAAK,CAAC,OAAO,GAAG,EAAE,CAAC;MACnB,OAAO,CAAC,UAAU,GAAG,IAAI,CAAC;MAC1B,OAAO,CAAC,IAAI,GAAG,CAAC,CAAC;MACjB,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC;MACd,OAAO,CAAC,QAAQ,GAAGE,MAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MACxC,OAAO,CAAC,MAAM,GAAGA,MAAI,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MACpC,OAAO,CAAC,MAAM,GAAGA,MAAI,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;;MAEpCC,GAAG,CAAC,SAAS,GAAGD,MAAI,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MAC9B,IAAI,OAAO,CAAC,MAAM,KAAK,MAAM,IAAE,SAAS,IAAI,OAAO,CAAC,MAAM,GAAC;WACtD,IAAI,OAAO,CAAC,MAAM,KAAK,OAAO,IAAE,SAAS,IAAI,OAAO,CAAC,MAAM,GAAC;;MAEjEC,GAAG,CAAC,SAAS,GAAGD,MAAI,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MAC9B,IAAI,OAAO,CAAC,MAAM,KAAK,KAAK,IAAE,SAAS,IAAI,OAAO,CAAC,MAAM,GAAC;WACrD,IAAI,OAAO,CAAC,MAAM,KAAK,QAAQ,IAAE,SAAS,IAAI,OAAO,CAAC,MAAM,GAAC;;MAElE,OAAO,CAAC,CAAC,GAAG,SAAS,CAAC;MACtB,OAAO,CAAC,CAAC,GAAG,SAAS,CAAC;;MAEtB,OAAO,OAAO,CAAC;;KAEhB,CAAC,CAAC;;;IAGH,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;IAC3B,IAAI,EAAE;OACH,GAAG,WAAC,EAAC,CAAC,SAAG,CAAC,CAAC,WAAQ,CAAC;OACpB,OAAO,CAAC,WAAW,CAAC;OACpB,OAAO,WAAC,UAAS,CAAC,AAAG;QACpBF,GAAK,CAAC,SAAS,GAAG,SAAS,CAAC,GAAG,CAAC;QAChCE,MAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,SAAS,CAAC,EAAE;WAC/C,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;WACtB,MAAM,CAAC,IAAI,CAAC,gCAA6B,SAAS,CAAE,EAAE,CAAC,MAAM,EAAEA,MAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;WACrF,MAAM,CAAC;YACN,MAAM,YAAE,EAAC,CAAC,SAAG,CAAC,CAAC,MAAM,KAAK,KAAK,IAAI,CAAC,CAAC,MAAM,KAAK,QAAQ,GAAG,CAAC,GAAG,KAAE;YACjE,KAAK,YAAE,EAAC,CAAC,SAAG,CAAC,CAAC,MAAM,KAAK,KAAK,IAAI,CAAC,CAAC,MAAM,KAAK,QAAQ,GAAG,EAAE,GAAG,IAAC;WACjE,CAAC;WACD,MAAM,CAAC,UAAU,CAAC,IAAI,CAACA,MAAI,CAAC,CAACA,MAAI,CAAC,eAAe,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;WACvE,MAAM,EAAE,CAAC,CAAC;OACd,CAAC,CAAC;;IAEL,OAAO,IAAI,CAAC;;IAEb;;;;;;;;oBAQD,yBAAM,CAAC,CAAC,EAAE;IACR,IAAI,IAAI,CAAC,KAAK,IAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,GAAC;IACrC,IAAI,IAAI,CAAC,gBAAgB,IAAE,IAAI,CAAC,gBAAgB,CAAC,OAAO,WAAC,SAAQ,CAAC,SAAG,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAC,CAAC,GAAC;IAC1F;;;;;;;;oBAQD,qBAAI,CAAC,CAAC,EAAE;IACN,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC;IAC/D;;;;;;;;oBAQD,6BAAQ,CAAC,CAAC,EAAE;IACV,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,KAAK,UAAU,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC;IAC/G;;;;;;;;oBAQD,yCAAc,CAAC,CAAC,EAAE;IAChB,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,eAAe,GAAG,MAAM,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC;IACjH;;;;;;;;oBAQD,uBAAK,CAAC,CAAC,EAAE;IACP,IAAI,IAAI,CAAC,KAAK,IAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,GAAC;IACpC,IAAI,IAAI,CAAC,gBAAgB,IAAE,IAAI,CAAC,gBAAgB,CAAC,OAAO,WAAC,SAAQ,CAAC,SAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,IAAC,CAAC,GAAC;IACzF;;;;;;;;oBAQD,yBAAM,CAAC,CAAC,EAAE;IACR,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,KAAK,UAAU,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC;IAC3G;;;;;;;;oBAQD,iCAAU,CAAC,CAAC,EAAE;IACZ,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC;IACrG;;;;;;;;oBAQD,yBAAM,CAAC,CAAC,EAAE;IACR,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,KAAK,UAAU,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC;IAC3G;;;;;;;;oBAQD,2BAAM,CAAC,CAAC,EAAE;IACR,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC;IAC3E;;;;;;;;;;;;oBAYD,eAAC,CAAC,CAAC,EAAE;IACH,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,OAAO,CAAC,KAAK,UAAU,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC;IACjG;;;;;;;;;;;;oBAYD,eAAC,CAAC,CAAC,EAAE;IACH,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,OAAO,CAAC,KAAK,UAAU,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC;GACjG;;;EAvOkC;;uBAyOpC;"}