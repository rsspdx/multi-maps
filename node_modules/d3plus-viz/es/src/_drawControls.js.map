{"version":3,"file":"_drawControls.js","sources":["../../src/_drawControls.js"],"sourcesContent":["import {elem} from \"d3plus-common\";\nimport {saveElement} from \"d3plus-export\";\nimport {Button, Radio, Select} from \"d3plus-form\";\nconst formTypes = {Button, Radio, Select};\n\n/**\n    @function _drawLegend\n    @desc Renders the legend if this._legend is not falsy.\n    @param {Array} dara The filtered data array to be displayed.\n    @private\n*/\nexport default function() {\n\n  const that = this;\n\n  const areas = [\"left\", \"right\", \"top\", \"bottom\"];\n  for (let a = 0; a < areas.length; a++) {\n    const area = areas[a];\n    const controls = (this._controls || []).filter(c => !c.position && area === \"bottom\" || c.position === area);\n\n    if (this._downloadButton && this._downloadPosition === area) {\n      controls.push({\n        data: [{text: \"Download\", value: 1}],\n        label: \"downloadButton\",\n        on: {\n          click: () => {\n            const resize = this._detectResize;\n            if (resize) this.detectResize(false).render();\n            saveElement(this._select.node(), Object.assign({\n              title: this._title || undefined\n            }, this._downloadConfig), {\n              callback: () => {\n                setTimeout(() => {\n                  if (resize) this.detectResize(resize).render();\n                }, 5000);\n              }\n            });\n          }\n        },\n        type: \"Button\"\n      });\n    }\n\n    const wide = area === \"top\" || area === \"bottom\";\n\n    const transform = {\n      height: wide ? this._height - (this._margin.top + this._margin.bottom) : this._height - (this._margin.top + this._margin.bottom + this._padding.top + this._padding.bottom),\n      width: wide ? this._width - (this._margin.left + this._margin.right + this._padding.left + this._padding.right) : this._width - (this._margin.left + this._margin.right)\n    };\n\n    transform.x = (wide ? this._margin.left + this._padding.left : this._margin.left) + (area === \"right\" ? transform.width : 0);\n    transform.y = (wide ? this._margin.top : this._margin.top + this._padding.top)  + (area === \"bottom\" ? transform.height : 0);\n\n    const foreign = elem(`foreignObject.d3plus-viz-controls-${area}`, {\n      condition: controls.length,\n      enter: Object.assign({opacity: 0}, transform),\n      exit: Object.assign({opacity: 0}, transform),\n      parent: this._select,\n      transition: this._transition,\n      update: {height: transform.height, opacity: 1, width: transform.width}\n    });\n\n    let container = foreign.selectAll(\"div.d3plus-viz-controls-container\")\n      .data([null]);\n\n    container = container.enter().append(\"xhtml:div\")\n        .attr(\"class\", \"d3plus-viz-controls-container\")\n      .merge(container);\n\n    if (controls.length) {\n\n      for (let i = 0; i < controls.length; i++) {\n\n        const control = Object.assign({}, controls[i]);\n\n        const on = {};\n        if (control.on) {\n          for (const event in control.on) {\n            if ({}.hasOwnProperty.call(control.on, event)) {\n              on[event] = function() {\n                control.on[event].bind(that)(this.value);\n              };\n            }\n          }\n\n        }\n\n        const id = control.label || `${area}-${i}`;\n        if (!this._controlCache[id]) {\n          const type = control.type && formTypes[control.type] ? control.type : \"Select\";\n          this._controlCache[id] = new formTypes[type]().container(container.node());\n          if (control.checked) this._controlCache[id].checked(control.checked);\n          if (control.selected) this._controlCache[id].selected(control.selected);\n        }\n        delete control.checked;\n        delete control.selected;\n\n        this._controlCache[id]\n          .config(control)\n          .config({on})\n          .config(this._controlConfig)\n          .render();\n\n      }\n\n      container\n          .style(\"display\", [\"top\", \"bottom\"].includes(area) ? \"block\" : \"inline-block\")\n          .style(\"text-align\", [\"top\", \"bottom\"].includes(area) ? \"center\" : area);\n\n      const bounds = container.node().getBoundingClientRect();\n\n      foreign.transition(this._transition)\n        .attr(\"x\", transform.x - (area === \"right\" ? bounds.width : 0))\n        .attr(\"y\", transform.y - (area === \"bottom\" ? bounds.height : 0));\n\n      this._margin[area] += [\"top\", \"bottom\"].includes(area) ? bounds.height : bounds.width;\n\n    }\n\n  }\n\n}\n"],"names":["const","a","i","let","this"],"mappings":"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"}