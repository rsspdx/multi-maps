{"version":3,"file":"_drawTimeline.js","sources":["../../src/_drawTimeline.js"],"sourcesContent":["import {extent} from \"d3-array\";\n\nimport {date} from \"d3plus-axis\";\nimport {elem} from \"d3plus-common\";\n\n/**\n    @function setTimeFilter\n    @desc Determines whether or not to update the timeFilter method of the Viz.\n    @param {Array|Date} The timeline selection given from the d3 brush.\n    @private\n*/\nfunction setTimeFilter(s) {\n  if (!(s instanceof Array)) s = [s, s];\n  if (JSON.stringify(s) !== JSON.stringify(this._timelineSelection)) {\n    this._timelineSelection = s;\n    s = s.map(Number);\n    this.timeFilter(d => {\n      const ms = date(this._time(d)).getTime();\n      return ms >= s[0] && ms <= s[1];\n    }).render();\n  }\n}\n\n/**\n    @function _drawTimeline\n    @desc Renders the timeline if this._time and this._timeline are not falsy and there are more than 1 tick available.\n    @param {Array} data The filtered data array to be displayed.\n    @private\n*/\nexport default function(data = []) {\n\n  let timelinePossible = this._time && this._timeline;\n  const ticks = timelinePossible ? Array.from(new Set(this._data.map(this._time))).map(date) : [];\n  timelinePossible = timelinePossible && ticks.length > 1;\n\n  const transform = {transform: `translate(${this._margin.left + this._padding.left}, 0)`};\n\n  const timelineGroup = elem(\"g.d3plus-viz-timeline\", {\n    condition: timelinePossible,\n    enter: transform,\n    parent: this._select,\n    transition: this._transition,\n    update: transform\n  }).node();\n\n  if (timelinePossible) {\n\n    const timeline = this._timelineClass\n      .domain(extent(ticks))\n      .duration(this._duration)\n      .height(this._height - this._margin.bottom)\n      .select(timelineGroup)\n      .ticks(ticks.sort((a, b) => +a - +b))\n      .width(this._width - (this._margin.left + this._margin.right + this._padding.left + this._padding.right));\n\n    if (timeline.selection() === undefined) {\n      this._timelineSelection = extent(data, this._time).map(date);\n      timeline.selection(this._timelineSelection);\n    }\n\n    const config = this._timelineConfig;\n\n    timeline\n      .config(config)\n      // .on(\"brush\", s => {\n      //   setTimeFilter.bind(this)(s);\n      //   if (config.on && config.on.brush) config.on.brush(s);\n      // })\n      .on(\"end\", s => {\n        setTimeFilter.bind(this)(s);\n        if (config.on && config.on.end) config.on.end(s);\n      })\n      .render();\n\n    this._margin.bottom += timeline.outerBounds().height + timeline.padding() * 2;\n\n  }\n\n}\n"],"names":["const","this","let"],"mappings":"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"}